{"remainingRequest":"/Users/liyanliang/Desktop/便家/tob-bianjia-clint/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liyanliang/Desktop/便家/tob-bianjia-clint/src/components/goods/Add.vue?vue&type=style&index=0&id=62ac4b68&lang=less&scoped=true&","dependencies":[{"path":"/Users/liyanliang/Desktop/便家/tob-bianjia-clint/src/components/goods/Add.vue","mtime":1679735545016},{"path":"/Users/liyanliang/Desktop/便家/tob-bianjia-clint/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liyanliang/Desktop/便家/tob-bianjia-clint/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/liyanliang/Desktop/便家/tob-bianjia-clint/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/liyanliang/Desktop/便家/tob-bianjia-clint/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liyanliang/Desktop/便家/tob-bianjia-clint/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liyanliang/Desktop/便家/tob-bianjia-clint/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZWwtY2hlY2tib3ggewogIG1hcmdpbjogMCAxMHB4IDAgMCAhaW1wb3J0YW50Owp9Ci5wcmV2aWV3SW1nIHsKICB3aWR0aDogMTAwJTsKfQo="},{"version":3,"sources":["Add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4RA;AACA;AACA;AACA;AACA;AACA","file":"Add.vue","sourceRoot":"src/components/goods","sourcesContent":["<template>\n  <div>\n    <!-- 面包屑 -->\n    <el-breadcrumb separator=\"/\">\n      <el-breadcrumb-item :to=\"{ path: '/home' }\">首页</el-breadcrumb-item>\n      <el-breadcrumb-item>\n        <a href=\"/home\">商品管理</a>\n      </el-breadcrumb-item>\n      <el-breadcrumb-item>添加商品</el-breadcrumb-item>\n    </el-breadcrumb>\n\n    <!-- 卡片布局 -->\n    <el-card>\n      <el-alert title=\"添加商品信息\" type=\"info\" :closable=\"false\" center show-icon></el-alert>\n      <!-- 步骤条 -->\n\n      <el-steps align-center :space=\"200\" :active=\"activeIndex-0\" finish-status=\"success\">\n        <el-step title=\"基本信息\"></el-step>\n        <el-step title=\"商品参数\"></el-step>\n        <el-step title=\"商品信息\"></el-step>\n        <el-step title=\"商品图片\"></el-step>\n        <el-step title=\"商品内容\"></el-step>\n        <el-step title=\"完成\"></el-step>\n      </el-steps>\n\n      <!-- tab栏 -->\n      <el-form\n        :model=\"addForm\"\n        :rules=\"addFormRules\"\n        ref=\"addFormRef\"\n        label-width=\"100px\"\n        label-position=\"top\"\n      >\n        <el-tabs\n          @tab-click=\"tabClicked\"\n          :before-leave=\"beforTabLeave\"\n          v-model=\"activeIndex\"\n          :tab-position=\"'left'\"\n        >\n          <el-tab-pane name=\"0\" label=\"基本信息\">\n            <el-form-item label=\"商品名称\" prop=\"goods_name\">\n              <el-input v-model=\"addForm.goods_name\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"商品价格\" prop=\"goods_price\">\n              <el-input v-model=\"addForm.goods_price\" type=\"number\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"商品重量\" prop=\"goods_weight\">\n              <el-input v-model=\"addForm.goods_weight\" type=\"number\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"商品数量\" prop=\"goods_number\">\n              <el-input v-model=\"addForm.goods_number\" type=\"number\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"商品分类：\" prop=\"goods_cat\">\n              <el-cascader\n                :options=\"catelist\"\n                :props=\"cateProps\"\n                clearable\n                v-model=\"addForm.goods_cat\"\n                @change=\"CateChanged\"\n              ></el-cascader>\n            </el-form-item>\n          </el-tab-pane>\n          <el-tab-pane name=\"1\" label=\"商品参数\">\n            <el-form-item :label=\"item.attr_name\" v-for=\"item in manyTableData\" :key=\"item.arrt_id\">\n              <!-- 复选框 -->\n              <el-checkbox-group v-model=\"item.attr_vals\">\n                <el-checkbox :label=\"cb\" v-for=\"(cb,i) in item.attr_vals\" :key=\"i\" border></el-checkbox>\n              </el-checkbox-group>\n            </el-form-item>\n          </el-tab-pane>\n          <el-tab-pane name=\"2\" label=\"商品信息\">\n            <el-form-item :label=\"item.attr_name\" v-for=\"item in onlyTableData\" :key=\"item.arrt_id\">\n              <!-- 复选框 -->\n              <el-checkbox-group v-model=\"item.attr_vals\">\n                <el-checkbox :label=\"cb\" v-for=\"(cb,i) in item.attr_vals\" :key=\"i\" border></el-checkbox>\n              </el-checkbox-group>\n              <el-input v-model=\"item.attr_vals\"></el-input>\n            </el-form-item>\n          </el-tab-pane>\n          <el-tab-pane name=\"3\" label=\"商品图片\">\n            <!-- 图片上传 -->\n            <!-- action上传地址 -->\n            <el-upload\n              :action=\"upURL\"\n              :on-preview=\"handlePreview\"\n              :on-remove=\"handleRemove\"\n              list-type=\"picture\"\n              :headers=\"headerObj\"\n              :on-success=\"handleSuccess\"\n            >\n              <el-button size=\"small\" type=\"primary\">点击上传</el-button>\n              <div slot=\"tip\" class=\"el-upload__tip\">只能上传jpg/png文件，且不超过500kb</div>\n            </el-upload>\n          </el-tab-pane>\n          <el-tab-pane name=\"4\" label=\"商品内容\">\n            <quill-editor v-model=\"addForm.goods_introduce\"></quill-editor>\n            <el-button @click=\"add\" type=\"primary\" class=\"btnadd\">添加商品</el-button>\n          </el-tab-pane>\n        </el-tabs>\n      </el-form>\n    </el-card>\n\n    <!-- 图片预览 -->\n    <el-dialog title=\"图片预览\" :visible.sync=\"previewVisible\" width=\"50%\">\n      <img class=\"previewImg\" :src=\"previewPath\" alt=\"图片\" />\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport _ from \"lodash\";\nexport default {\n  data() {\n    return {\n      activeIndex: \"0\",\n      addForm: {\n        goods_name: \"\",\n        goods_price: 0,\n        goods_weight: 0,\n        goods_number: 0,\n        // 商品分类数组\n        goods_cat: [],\n        pics: [],\n        goods_introduce: \"\",\n        attrs: []\n      },\n      addFormRules: {\n        goods_name: [\n          { required: true, message: \"请输入商品名称\", trigger: \"blur\" }\n        ],\n        goods_price: [\n          { required: true, message: \"请输入商品价格\", trigger: \"blur\" }\n        ],\n        goods_wight: [\n          { required: true, message: \"请输入商品重量\", trigger: \"blur\" }\n        ],\n        goods_number: [\n          { required: true, message: \"请输入商品数量\", trigger: \"blur\" }\n        ],\n        goods_cat: [\n          { required: true, message: \"请选择商品分类\", trigger: \"blur\" }\n        ]\n      },\n      catelist: [],\n      cateProps: {\n        expandTrigger: \"hover\",\n        value: \"cat_id\",\n        label: \"cat_name\",\n        children: \"children\"\n      },\n      // 动态参数数据\n      manyTableData: [],\n      onlyTableData: [],\n      upURL: \"https://www.liulongbin.top:8888/api/private/v1/upload\",\n      // 图片上传请求头\n      headerObj: {\n        Authorization: window.sessionStorage.getItem(\"token\")\n      },\n      pics: [],\n      previewPath: \"\",\n      previewVisible: false\n    };\n  },\n  created() {\n    this.getCateList();\n  },\n  methods: {\n    async getCateList() {\n      const { data: res } = await this.$http.get(\"categories\");\n      if (res.meta.status !== 200) {\n        return this.$message.error(res.meta.msg);\n      }\n      this.catelist = res.data;\n    },\n    CateChanged() {\n      if (this.addForm.goods_cat.length !== 3) {\n        this.addForm.goods_cat = [];\n        this.$message.error(\"请选择三级分类\");\n      }\n    },\n    beforTabLeave(activeName, oldActiveName) {\n      // console.log(activeName, oldActiveName);\n      if (oldActiveName === \"0\" && this.addForm.goods_cat.length !== 3) {\n        this.$message.error(\"请选择三级商品分类\");\n        return false;\n      }\n    },\n    async tabClicked() {\n      if (this.activeIndex === \"1\") {\n        const { data: res } = await this.$http.get(\n          `categories/${this.cateId}/attributes`,\n          {\n            params: { sel: \"many\" }\n          }\n        );\n        if (res.meta.status !== 200) {\n          return this.$message.error(\"获取失败！\");\n        }\n        // console.log(res.data);\n        res.data.forEach(item => {\n          item.attr_vals =\n            item.attr_vals.length === 0 ? [] : item.attr_vals.split(\" \");\n        });\n        this.manyTableData = res.data;\n      } else if (this.activeIndex === \"2\") {\n        const { data: res } = await this.$http.get(\n          `categories/${this.cateId}/attributes`,\n          {\n            params: { sel: \"only\" }\n          }\n        );\n        if (res.meta.status !== 200) {\n          return this.$message.error(\"获取失败！\");\n        }\n        // console.log(res.data);\n        res.data.forEach(item => {\n          item.attr_vals =\n            item.attr_vals.length === 0 ? [] : item.attr_vals.split(\" \");\n        });\n        this.onlyTableData = res.data;\n      }\n    },\n    // 处理图片预览\n    handlePreview(file) {\n      this.previewPath = file.response.data.url;\n      this.previewVisible = true;\n    },\n    //移除\n    handleRemove(file) {\n      const picPath = file.response.data.tmp_path;\n      const i = this.addForm.pics.findIndex(x => x.pic === picPath);\n      this.addForm.pics.splice(i, 1);\n    },\n\n    handleSuccess(res) {\n      const picInfo = { pic: res.data.tmp_path };\n      this.addForm.pics.push(picInfo);\n      // console.log(this.addForm);\n    },\n    add() {\n      // console.log(this.addForm);\n      this.$refs.addFormRef.validate(async valid => {\n        if (!valid) {\n          return this.$message.error(\"请填写必要的信息\");\n        }\n        const form = _.cloneDeep(this.addForm);\n        form.goods_cat = form.goods_cat.join(\",\");\n        this.manyTableData.forEach(item => {\n          const newInfo = {\n            attr_id: item.attr_id,\n            attr_value: item.attr_vals.join(\" \")\n          };\n          this.addForm.attrs.push(newInfo);\n        });\n        this.onlyTableData.forEach(item => {\n          const newInfo = {\n            attr_id: item.attr_id,\n            attr_value: item.attr_vals\n          };\n          this.addForm.attrs.push(newInfo);\n        });\n        form.attrs = this.addForm.attrs;\n        // console.log(form);\n        const { data: res } = await this.$http.post(\"goods\", form);\n        if (res.meta.status !== 201) {\n          return this.$message.error(\"添加失败\");\n        }\n        this.$message.success(\"添加商品成功！\");\n        this.$router.push(\"/goods\");\n      });\n    }\n  },\n  computed: {\n    cateId() {\n      if (this.addForm.goods_cat.length === 3) {\n        return this.addForm.goods_cat[2];\n      }\n      return null;\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.el-checkbox {\n  margin: 0 10px 0 0 !important;\n}\n.previewImg {\n  width: 100%;\n}\n</style>"]}]}